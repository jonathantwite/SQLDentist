---
title: sp_executesql output variables
description: Returning data from the sp_executesql stored procedure.
author: Jonathan Twite
createdAt: 2021-09-16
---

Sometimes you need to build the SQL code you want to run prior to running it to SSMS, for example if the database name is unknown or changeable.  The inbuilt `sp_executesql` stored procedure can be used to run this a string generated by prior statements.  Data can be returned back from the procedure using the `OUTPUT` keyword as follows.

```sql{}[ReturnData.sql//2012]
DECLARE 
    @DbName NVARCHAR(128) = ... /* Calculated or set by user */,
    @AccountName VARCHAR(50) = ... /* Dito */;

DECLARE @SqlInsert NVARCHAR(MAX) = N'
    INSERT INTO ' + @DbName + '.dbo.Account (AccountName) VALUES (@AccountName);
    SET @NewID = SCOPE_IDENTITY();';

DECLARE @NewIdReturned INT;

EXEC sys.sp_executesql 
    @stmt = @SqlInsert, 
    @params = N'@AccountName VARCHAR(50), @NewID INT OUTPUT', 
    @AccountName = @AccountName, 
    @NewID = @NewIdReturned OUTPUT;

/* Do something with @NewIdReturned */
```

Be aware that the `@params` parameter requires an `NVARCHAR` - a string requires prepending with a `N`.
